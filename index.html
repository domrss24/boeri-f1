<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#000000">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;500;600;700;800&family=Bebas+Neue&display=swap" rel="stylesheet">
<title>BOERI F1</title>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<style>
:root{
  --bg:#0a0a0f;--surf:#111118;--surf2:#1a1a24;--surf3:#222230;
  --red:#E10600;--red-lo:rgba(225,6,0,.13);--gold:#DAA520;
  --w:#fff;--g:#5a5a6e;--gl:#8a8a9e;--bdr:#2a2a38;
  --soft:#E8002D;--med:#FFC906;--hard:#C8C8C8;--inter:#39B54A;--fw:#0047AB;
  --r:12px;--st:env(safe-area-inset-top,0px);--sb:env(safe-area-inset-bottom,0px);
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;overflow:hidden;background:var(--bg);color:var(--w);font-family:'Barlow Condensed',sans-serif;-webkit-font-smoothing:antialiased;}
#app{display:flex;flex-direction:column;height:100%;max-width:520px;margin:0 auto;position:relative;}

/* HEADER */
.hdr{background:#000;border-bottom:3px solid var(--red);padding:11px 18px;padding-top:calc(11px + var(--st));display:flex;align-items:center;justify-content:space-between;flex-shrink:0;z-index:100;position:relative;}
.hdr-logo{font-family:'Bebas Neue',sans-serif;font-size:23px;letter-spacing:3px;display:flex;align-items:center;gap:7px;}
.hdr-logo .b{color:var(--red);}
.hdr-logo .ico{width:26px;height:26px;border:2px solid var(--red);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:13px;}
.ham{width:34px;height:34px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:5px;cursor:pointer;background:none;border:none;padding:4px;}
.ham span{display:block;width:21px;height:2px;background:#fff;border-radius:1px;}

/* MENU */
.menu-ov{position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);z-index:200;opacity:0;pointer-events:none;transition:opacity .25s;}
.menu-ov.open{opacity:1;pointer-events:auto;}
.menu-pan{position:absolute;top:0;right:-100%;width:255px;height:100%;background:#111;border-left:1px solid var(--bdr);transition:right .3s cubic-bezier(.4,0,.2,1);z-index:201;display:flex;flex-direction:column;padding-top:var(--st);}
.menu-ov.open .menu-pan{right:0;}
.menu-x{position:absolute;top:calc(10px + var(--st));right:14px;background:none;border:none;color:#fff;font-size:21px;cursor:pointer;}
.menu-hdr{padding:46px 18px 16px;border-bottom:1px solid var(--bdr);}
.menu-hdr .ml{font-family:'Bebas Neue',sans-serif;font-size:19px;letter-spacing:2px;}
.menu-hdr .ml .b{color:var(--red);}
.menu-items{flex:1;overflow-y:auto;padding:6px 0;}
.mi{display:flex;align-items:center;gap:13px;padding:12px 18px;cursor:pointer;color:var(--gl);font-size:13px;font-weight:600;border:none;background:none;width:100%;text-align:left;font-family:'Barlow Condensed',sans-serif;transition:.15s;}
.mi:hover,.mi.active{background:var(--red-lo);color:#fff;}
.mi .ic{width:18px;text-align:center;font-size:15px;}
.mi .lb{text-transform:uppercase;letter-spacing:1px;font-size:11.5px;}
.menu-div{height:1px;background:var(--bdr);margin:3px 18px;}
.menu-admin{border-top:1px solid var(--bdr);padding:6px 0 0;}
.menu-admin-lbl{font-size:8.5px;text-transform:uppercase;letter-spacing:1.5px;color:var(--g);padding:5px 18px 1px;font-weight:700;}

/* SCROLL CONTENT */
.content{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;padding-bottom:calc(58px + var(--sb));}

/* BOTTOM NAV */
.bnav{position:absolute;bottom:0;left:0;right:0;background:#000;border-top:1px solid var(--bdr);display:flex;justify-content:space-around;padding:5px 0;padding-bottom:var(--sb);z-index:100;flex-shrink:0;}
.nb{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;background:none;border:none;cursor:pointer;color:var(--g);transition:color .2s;padding:3px 0;font-family:'Barlow Condensed',sans-serif;}
.nb .ni{font-size:17px;}
.nb .nl{font-size:8.5px;text-transform:uppercase;letter-spacing:.4px;font-weight:600;}
.nb.active{color:var(--red);}

/* PAGES */
.pg{display:none;}
.pg.active{display:block;animation:fadeIn .22s;}
@keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}

/* LOGIN */
#login{position:absolute;top:0;left:0;right:0;bottom:0;background:#000;z-index:500;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 24px;}
#login.hidden{display:none;}
.login-logo{font-family:'Bebas Neue',sans-serif;font-size:50px;letter-spacing:5px;text-align:center;margin-bottom:6px;}
.login-logo .b{color:var(--red);}
.login-line{width:55px;height:3px;background:var(--red);margin:0 auto 28px;}
.login-sub{color:var(--g);font-size:12px;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:36px;text-align:center;}
.login-btn{background:#fff;color:#000;border:none;padding:13px 30px;border-radius:10px;font-family:'Barlow Condensed',sans-serif;font-size:15px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:9px;letter-spacing:.4px;transition:transform .15s;}
.login-btn:hover{transform:scale(1.03);}
.login-btn .gi{width:22px;height:22px;border-radius:50%;background:linear-gradient(135deg,#4285f4,#34a853,#fbbc05,#ea4335);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff;}

/* ONBOARDING OVERLAY */
#onboard{position:absolute;top:0;left:0;right:0;bottom:0;background:#000;z-index:499;display:none;flex-direction:column;align-items:center;justify-content:center;padding:30px 20px;overflow-y:auto;}
#onboard.show{display:flex;}
.onb-title{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:2px;color:#fff;text-align:center;margin-bottom:4px;}
.onb-sub{font-size:10.5px;color:var(--g);text-align:center;letter-spacing:1px;text-transform:uppercase;margin-bottom:20px;}
.onb-card{background:var(--surf);border:1px solid var(--bdr);border-radius:var(--r);width:100%;max-width:420px;overflow:hidden;margin-bottom:12px;}
.onb-card-hdr{background:var(--surf2);padding:10px 14px;font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--gold);font-weight:700;border-bottom:1px solid var(--bdr);display:flex;align-items:center;gap:6px;}
.onb-card-b{padding:14px;}
.onb-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--bdr);}
.onb-row:last-child{border-bottom:none;}
.onb-row .lbl{font-size:12px;color:var(--gl);font-weight:500;}
.onb-row .val{font-size:12px;color:#fff;font-weight:600;}
.onb-sel{background:var(--surf2);border:1px solid var(--bdr);border-radius:7px;padding:9px 11px;color:#fff;font-family:'Barlow Condensed',sans-serif;font-size:13px;outline:none;width:100%;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%238a8a9e'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:26px;}
.onb-sel option{background:#1a1a24;}
.onb-btn{display:block;width:100%;max-width:420px;margin:16px auto 0;background:var(--red);color:#fff;border:none;padding:13px;border-radius:9px;font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:2px;cursor:pointer;transition:background .18s;}
.onb-btn:hover{background:#c50500;}
.onb-btn:disabled{background:var(--surf3);color:var(--g);cursor:not-allowed;}
.onb-warn{font-size:9.5px;color:var(--g);text-align:center;max-width:420px;margin:10px auto 0;line-height:1.5;}
.onb-warn strong{color:var(--gold);}

/* CARDS */
.card{background:var(--surf);border:1px solid var(--bdr);border-radius:var(--r);margin:0 14px 10px;overflow:hidden;}
.card-hdr{padding:12px 15px;border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;}
.card-t{font-size:10.5px;text-transform:uppercase;letter-spacing:1.5px;color:var(--g);font-weight:700;display:flex;align-items:center;gap:7px;}
.card-t .ci{font-size:13px;}
.card-b{padding:13px 15px;}

/* GP HERO */
.gp-hero{margin:10px 14px;border-radius:var(--r);overflow:hidden;position:relative;min-height:135px;}
.gp-hero-bg{position:absolute;top:0;left:0;right:0;bottom:0;}
.gp-hero-c{position:relative;z-index:2;padding:17px;}
.gp-hero-flag{font-size:9.5px;text-transform:uppercase;letter-spacing:2px;color:rgba(255,255,255,.45);margin-bottom:3px;}
.gp-hero-name{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:#fff;line-height:1.1;}
.gp-hero-loc{font-size:11.5px;color:rgba(255,255,255,.55);margin-top:2px;}
.gp-status{display:inline-block;margin-top:9px;background:rgba(218,165,32,.15);border:1px solid var(--gold);color:var(--gold);font-size:9.5px;font-weight:700;padding:3px 9px;border-radius:18px;text-transform:uppercase;letter-spacing:1px;}
.gp-cd{margin-top:10px;display:flex;gap:8px;}
.cd-u{background:rgba(255,255,255,.07);border-radius:7px;padding:7px 9px;text-align:center;min-width:44px;}
.cd-n{font-family:'Bebas Neue',sans-serif;font-size:20px;color:#fff;}
.cd-l{font-size:7.5px;color:var(--g);text-transform:uppercase;letter-spacing:.4px;}

/* CHICCA */
.chicca{margin:0 14px 10px;background:linear-gradient(135deg,var(--surf),var(--surf2));border:1px solid var(--bdr);border-radius:var(--r);padding:14px;}
.chicca-t{font-size:9px;text-transform:uppercase;letter-spacing:1.5px;color:var(--gold);font-weight:700;margin-bottom:7px;display:flex;align-items:center;gap:5px;}
.chicca-txt{font-size:12.5px;color:var(--gl);line-height:1.55;font-weight:500;}
.chicca-txt .yr{color:var(--gold);font-weight:700;}

/* CURIOSITA */
.cur-item{padding:9px 0;border-bottom:1px solid var(--bdr);font-size:11.5px;color:var(--gl);line-height:1.5;font-weight:500;}
.cur-item:last-child{border-bottom:none;}

/* GP CHIPS */
.gp-chips{padding:10px 14px;display:flex;gap:7px;overflow-x:auto;-webkit-overflow-scrolling:touch;}
.gp-chips::-webkit-scrollbar{display:none;}
.gp-chip{flex-shrink:0;background:var(--surf2);border:1px solid var(--bdr);color:var(--gl);padding:6px 13px;border-radius:18px;font-size:10.5px;font-weight:600;cursor:pointer;white-space:nowrap;transition:.15s;font-family:'Barlow Condensed',sans-serif;letter-spacing:.4px;}
.gp-chip:hover{border-color:var(--red);color:#fff;}
.gp-chip.active{background:var(--red);border-color:var(--red);color:#fff;}
.gp-chip.done{border-color:var(--inter);color:var(--inter);}
.gp-chip.locked{opacity:.3;cursor:not-allowed;}

/* DEADLINE BANNER */
.dl-ban{margin:0 14px 10px;padding:9px 13px;background:rgba(218,165,32,.09);border:1px solid rgba(218,165,32,.28);border-radius:9px;display:flex;align-items:center;gap:7px;}
.dl-ban .icon{font-size:13px;}
.dl-ban .lbl{font-size:9.5px;color:var(--gold);font-weight:700;text-transform:uppercase;letter-spacing:.4px;}
.dl-ban .val{font-size:10.5px;color:var(--gl);}
.dl-ban.urgent{background:rgba(225,6,0,.12);border-color:rgba(225,6,0,.4);}
.dl-ban.urgent .lbl,.dl-ban.urgent .val{color:var(--red);}
.dl-ban.locked-ban{background:rgba(90,90,110,.12);border-color:rgba(90,90,110,.3);}
.dl-ban.locked-ban .lbl,.dl-ban.locked-ban .val{color:var(--g);}

/* POLE POSITION */
.pole-box{background:var(--surf2);border:1px solid var(--bdr);border-radius:9px;padding:11px 13px;cursor:pointer;transition:border-color .18s;display:flex;align-items:center;gap:10px;}
.pole-box:hover{border-color:var(--red);}
.pole-box.sel{border-color:var(--gold);background:rgba(218,165,32,.07);}
.pole-box .pole-ico{width:28px;height:28px;background:linear-gradient(135deg,#000,#222);border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;border:2px solid var(--gold);}
.pole-box .pole-ico svg{width:14px;height:14px;}
.pole-box .pole-inf .pole-lbl{font-size:8.5px;text-transform:uppercase;letter-spacing:1px;color:var(--gold);font-weight:700;}
.pole-box .pole-inf .pole-val{font-size:12px;color:var(--gl);font-weight:600;}
.pole-box.sel .pole-inf .pole-val{color:#fff;}

/* PODIO ‚Äî REAL PODIO LAYOUT */
.podio-wrap{display:flex;align-items:flex-end;justify-content:center;gap:6px;padding:0 10px;height:150px;}
.podio-col{display:flex;flex-direction:column;align-items:center;flex:1;}
.podio-block{width:100%;background:var(--surf2);border:1px solid var(--bdr);border-radius:9px;padding:10px 6px;text-align:center;cursor:pointer;transition:border-color .18s;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;}
.podio-block:hover{border-color:var(--red);}
.podio-block.sel{border-color:var(--gold);background:rgba(218,165,32,.07);}
.podio-block .pp{font-family:'Bebas Neue',sans-serif;font-size:15px;margin-bottom:3px;}
.pp.p1{color:var(--gold)}.pp.p2{color:#A8A9AD}.pp.p3{color:#CD7F32}
.podio-block .pv{font-size:10px;color:var(--g);font-weight:600;line-height:1.3;}
.podio-block.sel .pv{color:#fff;}
.podio-block .pt{font-size:7.5px;margin-top:2px;}
/* Heights: 2nd < 1st > 3rd */
.podio-col.p1 .podio-block{height:120px;}
.podio-col.p2 .podio-block{height:100px;}
.podio-col.p3 .podio-block{height:82px;}
/* Order: 2nd | 1st | 3rd */
.podio-col.p2{order:1;}
.podio-col.p1{order:2;}
.podio-col.p3{order:3;}

/* GOMME */
.gomme-slots{display:flex;gap:7px;margin-bottom:10px;}
.g-slot{flex:1;height:68px;border:2px dashed var(--bdr);border-radius:9px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.18s;position:relative;background:var(--surf2);flex-direction:column;gap:2px;}
.g-slot:hover{border-color:var(--gl);}
.g-slot .sn{font-family:'Bebas Neue',sans-serif;font-size:15px;color:rgba(255,255,255,.25);}
.g-slot.filled{border-style:solid;}
.g-slot.filled .sl{font-size:8px;font-weight:700;text-transform:uppercase;letter-spacing:.3px;}
.g-slot.filled .sv{font-size:7px;color:rgba(255,255,255,.5);text-align:center;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:0 3px;}
.g-slot.blocked{opacity:.25;cursor:not-allowed;border-style:solid;border-color:var(--bdr);}
.g-slot .sx{position:absolute;top:2px;right:3px;font-size:9px;cursor:pointer;opacity:.6;}

/* TIRE GRAPHICS in picker */
.tire-svg{width:32px;height:32px;flex-shrink:0;}

/* LEGENDA GOMME */
.gomme-legenda{margin-top:8px;background:var(--surf2);border:1px solid var(--bdr);border-radius:9px;padding:10px 12px;}
.gl-title{font-size:8.5px;text-transform:uppercase;letter-spacing:1px;color:var(--g);font-weight:700;margin-bottom:7px;}
.gl-row{display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid var(--bdr);}
.gl-row:last-child{border-bottom:none;}
.gl-row .gl-tire{width:22px;height:22px;border-radius:50%;flex-shrink:0;}
.gl-row .gl-info{flex:1;}
.gl-row .gl-name{font-size:10.5px;font-weight:700;}
.gl-row .gl-sub{font-size:8.5px;color:var(--g);}
.gl-row .gl-pts{font-size:11px;font-weight:700;white-space:nowrap;}

/* PICKER */
.pk-ov{position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);z-index:300;display:none;align-items:flex-end;}
.pk-ov.open{display:flex;}
.pk-pan{background:var(--surf);border-radius:14px 14px 0 0;width:100%;max-height:70vh;display:flex;flex-direction:column;padding-bottom:var(--sb);}
.pk-hdr{padding:11px 15px;border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;}
.pk-t{font-size:11.5px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;}
.pk-x{background:none;border:none;color:var(--g);font-size:19px;cursor:pointer;}
.pk-list{overflow-y:auto;max-height:calc(70vh - 55px);}
.pk-item{padding:12px 15px;border-bottom:1px solid var(--bdr);cursor:pointer;transition:background .13s;display:flex;align-items:center;gap:9px;background:none;border-left:none;border-right:none;width:100%;text-align:left;font-family:'Barlow Condensed',sans-serif;color:var(--gl);}
.pk-item:hover{background:var(--red-lo);color:#fff;}
.pk-item:last-child{border-bottom:none;}
.pk-item .pn{font-family:'Bebas Neue',sans-serif;font-size:14px;min-width:26px;text-align:center;}
.pk-item .td{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.pk-item .nm{font-size:12.5px;font-weight:600;}
.pk-item .tm{font-size:9.5px;color:var(--g);}
.pk-item .cat-dot{width:11px;height:11px;border-radius:3px;flex-shrink:0;}
.pk-item .cat-info .cat-name{font-size:13px;font-weight:700;}
.pk-item .cat-info .cat-sub{font-size:9.5px;color:var(--g);}

/* CLASSIFICA */
.cl-item{margin:0 14px 7px;background:var(--surf);border:1px solid var(--bdr);border-radius:var(--r);padding:11px 13px;display:flex;align-items:center;gap:9px;cursor:pointer;transition:background .15s;}
.cl-item:hover{background:var(--surf2);}
.cl-item.t1{border-color:rgba(218,165,32,.4);background:linear-gradient(135deg,#1f1a0a,var(--surf));}
.cl-item.t2{border-color:rgba(168,169,173,.28);}
.cl-item.t3{border-color:rgba(205,127,50,.28);}
.rb{width:27px;height:27px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',sans-serif;font-size:14px;flex-shrink:0;}
.rb.r1{background:rgba(218,165,32,.15);color:var(--gold);border:2px solid var(--gold);}
.rb.r2{background:rgba(168,169,173,.1);color:#A8A9AD;border:2px solid #A8A9AD;}
.rb.r3{background:rgba(205,127,50,.15);color:#CD7F32;border:2px solid #CD7F32;}
.rb.ro{background:var(--surf2);color:var(--g);border:1px solid var(--bdr);font-size:12px;}
.cl-avatar{width:36px;height:36px;border-radius:50%;flex-shrink:0;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center;}
.cl-inf{flex:1;min-width:0;}
.cl-nm{font-size:13.5px;font-weight:700;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.cl-st{font-size:9.5px;color:var(--g);margin-top:1px;}
.cl-pts{text-align:right;flex-shrink:0;display:flex;align-items:center;gap:3px;}
.cl-pn{font-family:'Bebas Neue',sans-serif;font-size:21px;color:#fff;}

/* POPUP PROFILO GIOCATORE */
.pop-ov{position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.65);z-index:350;display:none;align-items:center;justify-content:center;padding:20px;}
.pop-ov.open{display:flex;}
.pop-card{background:var(--surf);border:1px solid var(--bdr);border-radius:var(--r);width:100%;max-width:320px;overflow:hidden;}
.pop-hdr{padding:18px 15px 12px;text-align:center;border-bottom:1px solid var(--bdr);}
.pop-avatar{width:64px;height:64px;border-radius:50%;margin:0 auto 8px;display:flex;align-items:center;justify-content:center;}
.pop-nm{font-size:17px;font-weight:700;color:#fff;}
.pop-num{font-family:'Bebas Neue',sans-serif;font-size:28px;color:var(--red);}
.pop-body{padding:12px 15px;}
.pop-row{display:flex;justify-content:space-between;align-items:center;padding:7px 0;border-bottom:1px solid var(--bdr);}
.pop-row:last-child{border-bottom:none;}
.pop-row .pr-l{font-size:10.5px;color:var(--g);font-weight:600;text-transform:uppercase;letter-spacing:.5px;}
.pop-row .pr-v{font-size:11.5px;color:#fff;font-weight:600;}
.pop-x{position:absolute;top:10px;right:12px;background:none;border:none;color:var(--g);font-size:20px;cursor:pointer;}

/* REGOLAMENTO */
.reg-card{background:var(--surf);border:1px solid var(--bdr);border-radius:var(--r);overflow:hidden;margin:0 14px 9px;}
.reg-hdr{background:var(--surf2);padding:11px 15px;font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--gold);border-bottom:1px solid var(--bdr);display:flex;align-items:center;gap:7px;}
.reg-row{display:flex;justify-content:space-between;align-items:center;padding:9px 15px;border-bottom:1px solid var(--bdr);font-size:11.5px;}
.reg-row:last-child{border-bottom:none;}
.reg-row .rd{color:var(--gl);font-weight:500;}
.reg-row .rp{background:var(--red-lo);color:var(--red);padding:2px 9px;border-radius:11px;font-size:10.5px;font-weight:700;white-space:nowrap;}
.reg-row .rp.gr{background:rgba(57,181,74,.13);color:var(--inter);}

/* PROFILIO */
.prof-hero{margin:10px 14px;padding:22px 15px;background:var(--surf);border:1px solid var(--bdr);border-radius:var(--r);text-align:center;}
.prof-avatar{width:90px;height:90px;margin:0 auto 10px;border-radius:50%;display:flex;align-items:center;justify-content:center;position:relative;}
.prof-nm{font-size:19px;font-weight:700;color:#fff;}
.prof-num{font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--red);}

/* INPUTS */
.inp{width:100%;background:var(--surf2);border:1px solid var(--bdr);border-radius:7px;padding:9px 11px;color:#fff;font-family:'Barlow Condensed',sans-serif;font-size:13.5px;outline:none;transition:border-color .18s;}
.inp:focus{border-color:var(--red);}
.inp-lbl{font-size:8.5px;text-transform:uppercase;letter-spacing:1px;color:var(--g);display:block;margin-bottom:4px;font-weight:600;}
select.inp{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%238a8a9e'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:26px;background-color:var(--surf2);}
select.inp option{background:#1a1a24;}

/* COLOR SWATCHES */
.hc-row{display:flex;flex-wrap:wrap;gap:5px;margin-top:6px;}
.hc-swatch{width:21px;height:21px;border-radius:50%;cursor:pointer;transition:.13s;flex-shrink:0;}

/* BTN */
.btn-conf{display:block;width:calc(100% - 28px);margin:10px 14px;background:var(--red);color:#fff;border:none;padding:12px;border-radius:9px;font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:2px;cursor:pointer;transition:background .18s;}
.btn-conf:hover{background:#c50500;}
.btn-conf:disabled{background:var(--surf3);color:var(--g);cursor:not-allowed;}

/* TOAST */
.toast{position:fixed;bottom:calc(68px + var(--sb));left:50%;transform:translateX(-50%) translateY(18px);background:var(--surf2);border:1px solid var(--bdr);color:#fff;padding:9px 18px;border-radius:7px;font-size:11.5px;font-weight:600;white-space:nowrap;opacity:0;transition:.28s;z-index:400;pointer-events:none;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}

/* SESSIONI GP */
.sess-row{display:flex;justify-content:space-between;align-items:center;padding:7px 0;border-bottom:1px solid var(--bdr);}
.sess-row:last-child{border-bottom:none;}
.sess-row .s-name{font-size:11px;color:var(--gl);font-weight:600;}
.sess-row .s-date{font-size:10.5px;color:#fff;font-weight:600;text-align:right;}
.sess-row .s-sprint{font-size:8px;background:rgba(57,181,74,.15);color:var(--inter);padding:1px 5px;border-radius:8px;font-weight:700;margin-left:4px;text-transform:uppercase;}

/* PREVISIONE CAMPIONATO nel profilo */
.camp-card{background:var(--surf2);border:1px solid rgba(218,165,32,.3);border-radius:9px;padding:12px;margin-top:6px;}
.camp-card .cc-t{font-size:9px;text-transform:uppercase;letter-spacing:1px;color:var(--gold);font-weight:700;margin-bottom:8px;display:flex;align-items:center;gap:5px;}
.camp-card .cc-row{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid var(--bdr);}
.camp-card .cc-row:last-child{border-bottom:none;}
.camp-card .cc-l{font-size:10.5px;color:var(--gl);}
.camp-card .cc-v{font-size:11px;color:#fff;font-weight:700;display:flex;align-items:center;gap:4px;}
.camp-card .cc-locked{font-size:8.5px;color:var(--g);font-style:italic;margin-top:6px;}

/* SCROLLBAR */
::-webkit-scrollbar{width:3px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--bdr);border-radius:2px;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login">
  <div class="login-logo"><span class="b">BOERI</span> <span style="color:#fff">F1</span></div>
  <div class="login-line"></div>
  <div class="login-sub">Previsioni ¬∑ Gran Premio ¬∑ Formula 1</div>
  <button class="login-btn" id="loginBtn"><span class="gi">G</span> Accedi con Google</button>
</div>

<!-- ONBOARDING: Previsione Campionato -->
<div id="onboard">
  <div class="onb-title">üèÜ PREVISIONE CAMPIONATO</div>
  <div class="onb-sub">Questa previsione vale per tutta la stagione</div>
  <div class="onb-card">
    <div class="onb-card-hdr">ü•á Campione Mondiale Piloti ‚Äî 50 Boeri Dorati</div>
    <div class="onb-card-b">
      <select class="onb-sel" id="onbPiloti"><option value="">Seleziona pilota...</option></select>
    </div>
  </div>
  <div class="onb-card">
    <div class="onb-card-hdr">üèéÔ∏è Campione Mondiale Costruttori ‚Äî 50 Boeri Dorati</div>
    <div class="onb-card-b">
      <select class="onb-sel" id="onbTeam"><option value="">Seleziona scuderia...</option></select>
    </div>
  </div>
  <div class="onb-warn">‚ö†Ô∏è <strong>Questa previsione non pu√≤ essere modificata</strong> una volta confermata. Vali bene la tua scelta!</div>
  <button class="onb-btn" id="onbBtn" onclick="confOnboard()" disabled>CONFERMA PREVISIONE</button>
</div>

<!-- APP -->
<div id="app" style="display:none;">
  <div class="hdr">
    <div class="hdr-logo"><div class="ico">üèéÔ∏è</div><span><span class="b">BOERI</span><span style="color:#fff"> F1</span></span></div>
    <button class="ham" id="menuBtn"><span></span><span></span><span></span></button>
  </div>

  <!-- MENU -->
  <div class="menu-ov" id="menuOv">
    <div class="menu-pan">
      <button class="menu-x" id="menuX">‚úï</button>
      <div class="menu-hdr"><div class="ml"><span class="b">BOERI</span> F1</div></div>
      <div class="menu-items">
        <button class="mi active" data-pg="dashboard"><span class="ic">üè†</span><span class="lb">Dashboard</span></button>
        <button class="mi" data-pg="previsioni"><span class="ic">üèÅ</span><span class="lb">Le Mie Previsioni</span></button>
        <div class="menu-div"></div>
        <button class="mi" data-pg="classifica"><span class="ic">üèÜ</span><span class="lb">Classifica Boeri</span></button>
        <div class="menu-div"></div>
        <button class="mi" data-pg="profilio"><span class="ic">üë§</span><span class="lb">Il Mio Profilo</span></button>
        <div class="menu-div"></div>
        <button class="mi" data-pg="regolamento"><span class="ic">üìã</span><span class="lb">Regolamento</span></button>
        <div class="menu-div"></div>
        <button class="mi" id="logoutBtn"><span class="ic">‚öôÔ∏è</span><span class="lb">Logout</span></button>
      </div>
      <div class="menu-admin" id="adminSec" style="display:none;">
        <div class="menu-admin-lbl">üîß Admin</div>
        <button class="mi" data-pg="admin"><span class="ic">‚öôÔ∏è</span><span class="lb">Pannello Admin</span></button>
      </div>
    </div>
  </div>

  <!-- CONTENT -->
  <div class="content">

    <!-- ‚ïê‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê‚ïê -->
    <div class="pg active" id="pg-dashboard">
      <div class="gp-hero" id="gpHero">
        <div class="gp-hero-bg" id="gpHeroBg"></div>
        <div class="gp-hero-c">
          <div class="gp-hero-flag" id="gpFlag">GP 1 / 24</div>
          <div class="gp-hero-name" id="gpName">Gran Premio</div>
          <div class="gp-hero-loc" id="gpLoc">Circuito</div>
          <div class="gp-status" id="gpStat">Prossimo GP</div>
          <div class="gp-cd" id="gpCd">
            <div class="cd-u"><div class="cd-n" id="cd-d">--</div><div class="cd-l">Giorni</div></div>
            <div class="cd-u"><div class="cd-n" id="cd-h">--</div><div class="cd-l">Ore</div></div>
            <div class="cd-u"><div class="cd-n" id="cd-m">--</div><div class="cd-l">Min</div></div>
            <div class="cd-u"><div class="cd-n" id="cd-s">--</div><div class="cd-l">Sec</div></div>
          </div>
        </div>
      </div>

      <!-- CURIOSITA sulla dashboard -->
      <div class="card">
        <div class="card-hdr"><div class="card-t"><span class="ci">üí°</span> Curiosit√† ‚Äî GP in Corso</div></div>
        <div class="card-b" id="curDash"></div>
      </div>

      <!-- CHICCA del giorno -->
      <div class="chicca" id="chiccaCard">
        <div class="chicca-t"><span>üìÖ</span> In questo giorno nella Formula 1...</div>
        <div class="chicca-txt" id="chiccaTxt">Caricamento...</div>
      </div>

      <!-- PROSSIMO GP -->
      <div class="card" id="nextGpCard">
        <div class="card-hdr"><div class="card-t"><span class="ci">‚è≠Ô∏è</span> Prossimo GP</div></div>
        <div class="card-b" id="nextGpDash"></div>
      </div>

      <!-- Classifica mini -->
      <div class="card">
        <div class="card-hdr">
          <div class="card-t"><span class="ci">üèÜ</span> Classifica ‚Äî Top 3</div>
          <span style="font-size:10.5px;color:var(--red);cursor:pointer;font-weight:700;" onclick="goTo('classifica')">Tutto ‚Üí</span>
        </div>
        <div class="card-b" id="clMini"></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê PREVISIONI ‚ïê‚ïê‚ïê‚ïê -->
    <div class="pg" id="pg-previsioni">
      <div class="gp-chips" id="gpChips"></div>
      <div class="dl-ban" id="dlBan"><span class="icon">‚è∞</span><div><div class="lbl">Deadline previsioni</div><div class="val" id="dlVal">‚Äî</div></div></div>

      <!-- POLE POSITION -->
      <div class="card" id="cardPole">
        <div class="card-hdr"><div class="card-t"><span class="ci">üèÅ</span> Previsione Pole Position</div><span style="font-size:9.5px;color:var(--gold);font-weight:700;">2 Boeri</span></div>
        <div class="card-b"><div class="pole-box" id="poleBox" onclick="openPk('pole',0)"><div class="pole-ico"><svg viewBox="0 0 24 24" fill="none"><path d="M12 2L4 22h16L12 2z" fill="#DAA520"/><text x="12" y="18" text-anchor="middle" fill="#000" font-size="10" font-weight="bold" font-family="Arial">P</text></svg></div><div class="pole-inf"><div class="pole-lbl">Pole Position</div><div class="pole-val" id="poleVal">Seleziona pilota</div></div></div></div>
      </div>

      <!-- PODIO -->
      <div class="card" id="cardPodio">
        <div class="card-hdr"><div class="card-hdr"><div class="card-t"><span class="ci">ü•á</span> Previsione Podio</div><span style="font-size:9.5px;color:var(--gold);font-weight:700;">Max 10 Boeri</span></div></div>
        <div class="card-b" style="padding:11px 6px 6px;">
          <div class="podio-wrap" id="podioGrid"></div>
        </div>
      </div>

      <!-- GOMME -->
      <div class="card" id="cardGomme">
        <div class="card-hdr"><div class="card-t"><span class="ci">üîµ</span> Previsioni Gomme</div><span style="font-size:9.5px;color:var(--g);" id="slotsLabel">3 slot disponibili</span></div>
        <div class="card-b">
          <div class="gomme-slots" id="gommeSlots"></div>
          <!-- LEGENDA VALORE PREVISIONI -->
          <div class="gomme-legenda" id="gommeLeg"></div>
        </div>
      </div>

      <button class="btn-conf" id="btnConf" onclick="conferma()">CONFERMA PREVISIONI</button>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê CLASSIFICA ‚ïê‚ïê‚ïê‚ïê -->
    <div class="pg" id="pg-classifica">
      <div style="padding:10px 14px 0;font-size:9px;text-transform:uppercase;letter-spacing:1.5px;color:var(--g);text-align:center;margin-bottom:8px;">Classifica Generale ‚Äî Stagione 2026</div>
      <div id="clList"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê PROFILO ‚ïê‚ïê‚ïê‚ïê -->
    <div class="pg" id="pg-profilio">
      <div class="prof-hero">
        <div class="prof-avatar" id="profAvatar"></div>
        <div class="prof-num" id="profNum">7</div>
        <div class="prof-nm" id="profNm">Il Tuo Nome</div>
        <div style="font-size:10.5px;color:var(--g);margin-top:3px;" id="profEmail">‚Äî</div>
      </div>

      <!-- Previsione campionato nel profilo (sola lettura) -->
      <div class="card">
        <div class="card-hdr"><div class="card-t"><span class="ci">ü•á</span> Previsione Campionato</div></div>
        <div class="card-b" id="profCamp"></div>
      </div>

      <div class="card">
        <div class="card-hdr"><div class="card-t"><span class="ci">‚úèÔ∏è</span> Modifica Profilo</div></div>
        <div class="card-b">
          <div style="margin-bottom:10px;"><label class="inp-lbl">Nickname</label><input class="inp" id="inNick" placeholder="Il tuo nickname" oninput="updProf()"></div>
          <div style="display:flex;gap:9px;">
            <div style="flex:1;"><label class="inp-lbl">Numero Racing</label><input class="inp" id="inNum" type="number" min="2" max="99" placeholder="7" oninput="updProf()"></div>
            <div style="flex:1;"><label class="inp-lbl">Colore Numero</label><select class="inp" id="inNumColor"></select></div>
          </div>
          <div style="margin-top:10px;"><label class="inp-lbl">Scuderia Preferita</label><select class="inp" id="inSc"></select></div>
          <div style="margin-top:10px;"><label class="inp-lbl">Pilota Preferito</label><select class="inp" id="inPil"></select></div>
          <div style="margin-top:14px;">
            <label class="inp-lbl">Colori Avatar (2 colori scuderia)</label>
            <div style="display:flex;gap:12px;margin-top:7px;">
              <div style="flex:1;"><div style="font-size:8.5px;color:var(--g);margin-bottom:3px;">Colore 1</div><div class="hc-row" data-tgt="col1"></div></div>
              <div style="flex:1;"><div style="font-size:8.5px;color:var(--g);margin-bottom:3px;">Colore 2</div><div class="hc-row" data-tgt="col2"></div></div>
            </div>
          </div>
        </div>
      </div>
      <button class="btn-conf" onclick="saveProf()">SALVA PROFILO</button>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê REGOLAMENTO ‚ïê‚ïê‚ïê‚ïê -->
    <div class="pg" id="pg-regolamento">
      <div style="padding-top:10px;">
        <div class="reg-card"><div class="reg-hdr">üèÅ Previsione Pole Position</div>
          <div class="reg-row"><span class="rd">Pole position azzeccata</span><span class="rp gr">2 Boeri</span></div>
        </div>
        <div class="reg-card"><div class="reg-hdr">ü•á Previsione Podio</div>
          <div class="reg-row"><span class="rd">Podio perfetto (1¬∞, 2¬∞, 3¬∞ tutti esatti)</span><span class="rp gr">10 Boeri</span></div>
          <div class="reg-row"><span class="rd">2 posizioni esatte</span><span class="rp">7 Boeri</span></div>
          <div class="reg-row"><span class="rd">3 nomi giusti, posizioni sbagliate</span><span class="rp">6 Boeri</span></div>
          <div class="reg-row"><span class="rd">1 posizione esatta</span><span class="rp">4 Boeri</span></div>
          <div class="reg-row"><span class="rd">2 nomi giusti, posizioni sbagliate</span><span class="rp">3 Boeri</span></div>
          <div class="reg-row"><span class="rd">1 nome giusto, posizione sbagliata</span><span class="rp">1 Boero</span></div>
          <div class="reg-row"><span class="rd">Nessun nome indovinato</span><span class="rp" style="background:var(--surf3);color:var(--g);">0</span></div>
        </div>
        <div class="reg-card"><div class="reg-hdr">üîµ Previsioni Gomme ‚Äî Punteggio</div>
          <div class="reg-row"><span class="rd" style="display:flex;align-items:center;gap:7px;"><span style="width:16px;height:16px;border-radius:50%;background:var(--soft);display:inline-block;flex-shrink:0;"></span> SOFT ‚Äî 1 slot</span><span class="rp" style="background:rgba(232,0,45,.15);color:var(--soft);">1 Boero</span></div>
          <div class="reg-row"><span class="rd" style="display:flex;align-items:center;gap:7px;"><span style="width:16px;height:16px;border-radius:50%;background:var(--med);display:inline-block;flex-shrink:0;"></span> MEDIUM ‚Äî 1 slot</span><span class="rp" style="background:rgba(255,201,6,.15);color:var(--med);">2 Boeri</span></div>
          <div class="reg-row"><span class="rd" style="display:flex;align-items:center;gap:7px;"><span style="width:16px;height:16px;border-radius:50%;background:var(--hard);display:inline-block;flex-shrink:0;border:1px solid var(--bdr);"></span> HARD ‚Äî 1 slot</span><span class="rp" style="background:rgba(200,200,200,.12);color:var(--hard);">3 Boeri</span></div>
          <div class="reg-row"><span class="rd" style="display:flex;align-items:center;gap:7px;"><span style="width:16px;height:16px;border-radius:50%;background:var(--inter);display:inline-block;flex-shrink:0;"></span> INTERMEDIE ‚Äî 2 slot</span><span class="rp" style="background:rgba(57,181,74,.15);color:var(--inter);">4 Boeri</span></div>
          <div class="reg-row"><span class="rd" style="display:flex;align-items:center;gap:7px;"><span style="width:16px;height:16px;border-radius:50%;background:var(--fw);display:inline-block;flex-shrink:0;"></span> FULL WET ‚Äî 2 slot</span><span class="rp" style="background:rgba(0,71,171,.15);color:var(--fw);">5 Boeri</span></div>
        </div>
        <div class="reg-card"><div class="reg-hdr">üèÜ Previsione Campionato</div>
          <div class="reg-row"><span class="rd">Campione Mondiale Piloti</span><span class="rp gr">50 Boeri ü•á</span></div>
          <div class="reg-row"><span class="rd">Campione Mondiale Costruttori</span><span class="rp gr">50 Boeri ü•á</span></div>
        </div>
        <div class="reg-card"><div class="reg-hdr">üìã Regole Generali</div>
          <div class="reg-row" style="flex-direction:column;align-items:flex-start;gap:5px;">
            <span class="rd">‚Ä¢ Le previsioni devono essere inserite prima della deadline (2h prima di FP1).</span>
            <span class="rd">‚Ä¢ Una volta confermate, le previsioni non possono essere modificate.</span>
            <span class="rd">‚Ä¢ I punteggi vengono calcolati dopo ogni corsa dall'amministratore.</span>
            <span class="rd">‚Ä¢ INTERMEDIE e FULL WET costano 2 slot su 3 disponibili.</span>
            <span class="rd">‚Ä¢ Le previsioni per un GP si aprono solo dopo il calcolo dei punteggi del GP precedente.</span>
            <span class="rd">‚Ä¢ La previsione Campionato non pu√≤ essere modificata dopo la conferma.</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê ADMIN ‚ïê‚ïê‚ïê‚ïê -->
    <div class="pg" id="pg-admin">
      <div class="card" style="margin-top:10px;">
        <div class="card-hdr"><div class="card-t"><span class="ci">üîß</span> Pannello Admin</div></div>
        <div class="card-b" id="adminBody">
          <div style="font-size:11.5px;color:var(--gl);margin-bottom:14px;">Qui puoi gestire i GP bloccati/sbloccati e i profili dei giocatori.</div>
          <div style="margin-bottom:14px;">
            <div style="font-size:9.5px;text-transform:uppercase;letter-spacing:1px;color:var(--gold);margin-bottom:8px;font-weight:700;">GP Bloccati / Sbloccati</div>
            <div id="adminGpList"></div>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /content -->

  <!-- Bottom Nav -->
  <div class="bnav">
    <button class="nb active" data-pg="dashboard"><span class="ni">üè†</span><span class="nl">Home</span></button>
    <button class="nb" data-pg="previsioni"><span class="ni">üèÅ</span><span class="nl">Previsioni</span></button>
    <button class="nb" data-pg="classifica"><span class="ni">üèÜ</span><span class="nl">Classifica</span></button>
    <button class="nb" data-pg="profilio"><span class="ni">üë§</span><span class="nl">Profilo</span></button>
  </div>
</div><!-- /app -->

<!-- Picker Overlay -->
<div class="pk-ov" id="pkOv">
  <div class="pk-pan">
    <div class="pk-hdr"><div class="pk-t" id="pkTitle">Seleziona</div><button class="pk-x" onclick="closePk()">‚úï</button></div>
    <div class="pk-list" id="pkList"></div>
  </div>
</div>

<!-- Popup Profilo Giocatore -->
<div class="pop-ov" id="popOv">
  <div class="pop-card" style="position:relative;">
    <button class="pop-x" onclick="closePop()">‚úï</button>
    <div class="pop-hdr">
      <div class="pop-avatar" id="popAvatar"></div>
      <div class="pop-num" id="popNum">7</div>
      <div class="pop-nm" id="popNm">Nome</div>
    </div>
    <div class="pop-body" id="popBody"></div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FIREBASE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
firebase.initializeApp({
  apiKey:"AIzaSyAmjZI8T5I8WsZHlLTqFO7Gt7T5EUWOl1Y",
  authDomain:"boeri-formula1.firebaseapp.com",
  projectId:"boeri-formula1",
  storageBucket:"boeri-formula1.firebasestorage.app",
  messagingSenderId:"310380317265",
  appId:"1:310380317265:web:c0be53768f255cbfa88670",
  measurementId:"G-F0CD2VGKYW"
});
const auth=firebase.auth(), db=firebase.firestore();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATI STATICI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const T={
  mclaren:{n:"McLaren",c:"#FF8000"},ferrari:{n:"Ferrari",c:"#DC0000"},redbull:{n:"Red Bull",c:"#1E41FF"},
  mercedes:{n:"Mercedes",c:"#C8C8C8"},aston_martin:{n:"Aston Martin",c:"#006F62"},alpine:{n:"Alpine",c:"#0093FE"},
  williams:{n:"Williams",c:"#005AFF"},racing_bulls:{n:"Racing Bulls",c:"#00CFFF"},haas:{n:"Haas",c:"#B71C1C"},
  audi:{n:"Audi",c:"#1B4D3E"},cadillac:{n:"Cadillac",c:"#888888"}
};
const TK=Object.keys(T);
const D=[
  {num:3,name:"Max Verstappen",team:"redbull"},{num:4,name:"Lando Norris",team:"mclaren"},
  {num:5,name:"Gabriel Bortoleto",team:"audi"},{num:6,name:"Isack Hadjar",team:"redbull"},
  {num:10,name:"Pierre Gasly",team:"alpine"},{num:11,name:"Sergio P√©rez",team:"cadillac"},
  {num:12,name:"Kimi Antonelli",team:"mercedes"},{num:14,name:"Fernando Alonso",team:"aston_martin"},
  {num:16,name:"Charles Leclerc",team:"ferrari"},{num:18,name:"Lance Stroll",team:"aston_martin"},
  {num:23,name:"Alex Albon",team:"williams"},{num:27,name:"Nico H√ºlkenberg",team:"audi"},
  {num:30,name:"Liam Lawson",team:"racing_bulls"},{num:31,name:"Esteban Ocon",team:"haas"},
  {num:41,name:"Arvid Lindblad",team:"racing_bulls"},{num:43,name:"Franco Colapinto",team:"alpine"},
  {num:44,name:"Lewis Hamilton",team:"ferrari"},{num:55,name:"Carlos Sainz",team:"williams"},
  {num:63,name:"George Russell",team:"mercedes"},{num:77,name:"Valtteri Bottas",team:"cadillac"},
  {num:81,name:"Oscar Piastri",team:"mclaren"},{num:87,name:"Oliver Bearman",team:"haas"}
];

const NC={
  australia:["#00008B","#CF142B"],china:["#DE2910","#FFDE00"],japan:["#BC002D","#FFFFFF"],
  bahrain:["#CE1126","#000000"],saudi_arabia:["#006C35","#FFFFFF"],miami:["#3C3B6E","#B22234"],
  canada:["#FF0000","#FFFFFF"],monaco:["#CE1126","#FFFFFF"],spain:["#AA151B","#F1BF00"],
  austria:["#ED2939","#FFFFFF"],uk:["#00247D","#CF142B"],belgium:["#000000","#FDDA24"],
  hungary:["#CE2939","#477050"],netherlands:["#AE1C28","#21468B"],italy:["#009246","#CE2B37"],
  madrid:["#AA151B","#F1BF00"],azerbaijan:["#0092BC","#EF3340"],singapore:["#EF3340","#FFFFFF"],
  usa:["#3C3B6E","#B22234"],mexico:["#006847","#CE1126"],brazil:["#009739","#FEDF00"],
  las_vegas:["#3C3B6E","#B22234"],qatar:["#8A1538","#FFFFFF"],abu_dhabi:["#009739","#CE1126"]
};

const CAL=[
  {id:0,name:"Australia",location:"Melbourne",nation:"australia",race:"2026-03-08T14:00:00Z",fp1:"2026-03-06T02:30:00Z",fp2:"2026-03-06T06:00:00Z",fp3:"2026-03-07T02:30:00Z",quali:"2026-03-07T06:00:00Z",sprint:false},
  {id:1,name:"China",location:"Shanghai",nation:"china",race:"2026-03-15T06:00:00Z",fp1:"2026-03-13T03:00:00Z",fp2:"2026-03-13T06:30:00Z",fp3:"2026-03-14T03:00:00Z",quali:"2026-03-14T06:00:00Z",sprint:true,sprintQuali:"2026-03-13T09:30:00Z",sprintRace:"2026-03-14T09:30:00Z"},
  {id:2,name:"Japan",location:"Suzuka",nation:"japan",race:"2026-03-29T05:00:00Z",fp1:"2026-03-27T02:00:00Z",fp2:"2026-03-27T05:30:00Z",fp3:"2026-03-28T02:00:00Z",quali:"2026-03-28T05:00:00Z",sprint:false},
  {id:3,name:"Bahrain",location:"Sakhir",nation:"bahrain",race:"2026-04-12T12:00:00Z",fp1:"2026-04-10T09:00:00Z",fp2:"2026-04-10T12:30:00Z",fp3:"2026-04-11T09:00:00Z",quali:"2026-04-11T12:00:00Z",sprint:false},
  {id:4,name:"Saudi Arabia",location:"Jeddah",nation:"saudi_arabia",race:"2026-04-19T12:00:00Z",fp1:"2026-04-17T09:00:00Z",fp2:"2026-04-17T12:30:00Z",fp3:"2026-04-18T09:00:00Z",quali:"2026-04-18T12:00:00Z",sprint:false},
  {id:5,name:"Miami",location:"Miami",nation:"miami",race:"2026-05-03T18:00:00Z",fp1:"2026-05-01T16:30:00Z",fp2:"2026-05-01T20:00:00Z",fp3:"2026-05-02T16:30:00Z",quali:"2026-05-02T19:30:00Z",sprint:true,sprintQuali:"2026-05-01T23:00:00Z",sprintRace:"2026-05-02T23:00:00Z"},
  {id:6,name:"Canada",location:"Montreal",nation:"canada",race:"2026-05-24T18:00:00Z",fp1:"2026-05-22T16:30:00Z",fp2:"2026-05-22T20:00:00Z",fp3:"2026-05-23T16:30:00Z",quali:"2026-05-23T19:30:00Z",sprint:true,sprintQuali:"2026-05-22T23:00:00Z",sprintRace:"2026-05-23T23:00:00Z"},
  {id:7,name:"Monaco",location:"Monte Carlo",nation:"monaco",race:"2026-06-07T12:00:00Z",fp1:"2026-06-05T09:00:00Z",fp2:"2026-06-05T12:30:00Z",fp3:"2026-06-06T09:00:00Z",quali:"2026-06-06T12:00:00Z",sprint:false},
  {id:8,name:"Spagna",location:"Barcelona",nation:"spain",race:"2026-06-14T12:00:00Z",fp1:"2026-06-12T09:00:00Z",fp2:"2026-06-12T12:30:00Z",fp3:"2026-06-13T09:00:00Z",quali:"2026-06-13T12:00:00Z",sprint:false},
  {id:9,name:"Austria",location:"Spielberg",nation:"austria",race:"2026-06-28T12:00:00Z",fp1:"2026-06-26T09:00:00Z",fp2:"2026-06-26T12:30:00Z",fp3:"2026-06-27T09:00:00Z",quali:"2026-06-27T12:00:00Z",sprint:false},
  {id:10,name:"Gran Bretagna",location:"Silverstone",nation:"uk",race:"2026-07-05T13:00:00Z",fp1:"2026-07-03T10:00:00Z",fp2:"2026-07-03T13:30:00Z",fp3:"2026-07-04T10:00:00Z",quali:"2026-07-04T13:00:00Z",sprint:true,sprintQuali:"2026-07-03T16:30:00Z",sprintRace:"2026-07-04T16:30:00Z"},
  {id:11,name:"Belgio",location:"Spa",nation:"belgium",race:"2026-07-19T12:00:00Z",fp1:"2026-07-17T09:00:00Z",fp2:"2026-07-17T12:30:00Z",fp3:"2026-07-18T09:00:00Z",quali:"2026-07-18T12:00:00Z",sprint:false},
  {id:12,name:"Ungheria",location:"Budapest",nation:"hungary",race:"2026-07-26T12:00:00Z",fp1:"2026-07-24T09:00:00Z",fp2:"2026-07-24T12:30:00Z",fp3:"2026-07-25T09:00:00Z",quali:"2026-07-25T12:00:00Z",sprint:false},
  {id:13,name:"Olanda",location:"Zandvoort",nation:"netherlands",race:"2026-08-23T12:00:00Z",fp1:"2026-08-21T09:00:00Z",fp2:"2026-08-21T12:30:00Z",fp3:"2026-08-22T09:00:00Z",quali:"2026-08-22T12:00:00Z",sprint:true,sprintQuali:"2026-08-21T15:30:00Z",sprintRace:"2026-08-22T15:30:00Z"},
  {id:14,name:"Italia",location:"Monza",nation:"italy",race:"2026-09-06T12:00:00Z",fp1:"2026-09-04T09:00:00Z",fp2:"2026-09-04T12:30:00Z",fp3:"2026-09-05T09:00:00Z",quali:"2026-09-05T12:00:00Z",sprint:false},
  {id:15,name:"Madrid",location:"Madrid",nation:"madrid",race:"2026-09-13T12:00:00Z",fp1:"2026-09-11T09:00:00Z",fp2:"2026-09-11T12:30:00Z",fp3:"2026-09-12T09:00:00Z",quali:"2026-09-12T12:00:00Z",sprint:false},
  {id:16,name:"Azerbaijan",location:"Baku",nation:"azerbaijan",race:"2026-09-26T12:00:00Z",fp1:"2026-09-24T07:00:00Z",fp2:"2026-09-24T10:30:00Z",fp3:"2026-09-25T07:00:00Z",quali:"2026-09-25T10:00:00Z",sprint:false},
  {id:17,name:"Singapore",location:"Marina Bay",nation:"singapore",race:"2026-10-11T10:00:00Z",fp1:"2026-10-09T03:00:00Z",fp2:"2026-10-09T06:30:00Z",fp3:"2026-10-10T03:00:00Z",quali:"2026-10-10T06:00:00Z",sprint:true,sprintQuali:"2026-10-09T09:30:00Z",sprintRace:"2026-10-10T09:30:00Z"},
  {id:18,name:"Stati Uniti",location:"Austin",nation:"usa",race:"2026-10-25T20:00:00Z",fp1:"2026-10-23T16:30:00Z",fp2:"2026-10-23T20:00:00Z",fp3:"2026-10-24T16:30:00Z",quali:"2026-10-24T19:30:00Z",sprint:false},
  {id:19,name:"Messico",location:"Mexico City",nation:"mexico",race:"2026-11-01T20:00:00Z",fp1:"2026-10-30T16:30:00Z",fp2:"2026-10-30T20:00:00Z",fp3:"2026-10-31T16:30:00Z",quali:"2026-10-31T19:30:00Z",sprint:false},
  {id:20,name:"Brasile",location:"S√£o Paulo",nation:"brazil",race:"2026-11-08T17:00:00Z",fp1:"2026-11-06T16:30:00Z",fp2:"2026-11-06T20:00:00Z",fp3:"2026-11-07T16:30:00Z",quali:"2026-11-07T19:30:00Z",sprint:false},
  {id:21,name:"Las Vegas",location:"Las Vegas",nation:"las_vegas",race:"2026-11-21T22:00:00Z",fp1:"2026-11-19T22:30:00Z",fp2:"2026-11-20T02:00:00Z",fp3:"2026-11-20T22:30:00Z",quali:"2026-11-21T02:00:00Z",sprint:false},
  {id:22,name:"Qatar",location:"Lusail",nation:"qatar",race:"2026-11-29T15:00:00Z",fp1:"2026-11-27T10:00:00Z",fp2:"2026-11-27T13:30:00Z",fp3:"2026-11-28T10:00:00Z",quali:"2026-11-28T13:00:00Z",sprint:false},
  {id:23,name:"Abu Dhabi",location:"Yas Marina",nation:"abu_dhabi",race:"2026-12-06T13:00:00Z",fp1:"2026-12-04T10:00:00Z",fp2:"2026-12-04T13:30:00Z",fp3:"2026-12-05T10:00:00Z",quali:"2026-12-05T13:00:00Z",sprint:false}
];

const CUR={
  australia:["üèÜ Schumacher detiene il record con 4 vittorie a Melbourne (2000‚Äì2004).","üèéÔ∏è Ferrari √® la scuderia pi√π vincente in Australia con 11 vittorie storiche.","üìä Il record di pole √® stato stabilito da Verstappen nel 2024 con media oltre 250 km/h.","üéØ Il vincitore del GP di Australia ha poi vinto il campionato nel 70% dei casi."],
  italy:["üèÜ Monza √® il GP pi√π disputato nella storia della Formula 1.","üèéÔ∏è Il rettilineo pi√π lungo della F1: media oltre 300 km/h.","üìä Ferrari ha vinto pi√π volte di qualsiasi altra scuderia a Monza.","üéØ Nel 2020 Monza ha ospitato due GP nella stessa stagione per il COVID-19."],
  monaco:["üèÜ Senna detiene il record con 6 vittorie ‚Äî una leggenda su questa pista.","üèéÔ∏è Il circuito pi√π stretto della F1: sorpassare √® quasi impossibile.","üìä La piscina di Monaco √® una delle curve pi√π iconiche di tutta la F1.","üéØ Vincere a Monaco √® considerato il test definitivo per un pilota."],
  japan:["üèÜ Senna ha vinto 4 volte a Suzuka durante la rivalit√† con Prost.","üèéÔ∏è Il circuito √® stato costruito da Honda nel 1962 e resta iconico.","üìä La curva 130R richiede coraggio e precisione assolute.","üéØ 8 titoli mondiali sono stati decisi qui tra il 1986 e il 2007."]
};
CAL.forEach(g=>{if(!CUR[g.nation])CUR[g.nation]=["üèéÔ∏è Il GP di "+g.name+" √® una delle corse pi√π attese del calendario.","üìä Il circuito di "+g.location+" mette alla prova tutte le capacit√† dei piloti.","üéØ Le previsioni possono cambiare drasticamente in base alla strategia dei pit stop."];});

const HIST=[
  {m:1,d:1,y:1950,t:"Nel 1950 viene annunciato il primo Campionato Mondiale della Formula 1, che inizier√† il 13 maggio a Silverstone."},
  {m:2,d:1,y:2005,t:"Nel 2005, Narain Karthikeyan firm√≤ il contratto con Jordan, diventando il primo pilota indiano nella storia della Formula 1."},
  {m:2,d:2,y:1994,t:"Nel 1994, Ayrton Senna complet√≤ l'ultimo test a Fiorano prima della tragedia di Imola. Il mondo della F1 non sarebbe mai pi√π stato lo stesso."},
  {m:3,d:1,y:2000,t:"Nel 2000, Ferrari inizi√≤ la preparazione per una stagione storica: Schumacher avrebbe vinto il primo titolo con la scuderia italiana."},
  {m:5,d:1,y:1994,t:"Nel 1994, il mondo della Formula 1 si ferm√≤. Ayrton Senna aveva perso la vita a Imola durante il Gran Premio di San Marino."},
  {m:5,d:13,y:1950,t:"Nel 1950, a Silverstone si disput√≤ il primo Gran Premio della Formula 1 ufficiale. Giuseppe Farina vinse la corsa."},
  {m:5,d:26,y:2016,t:"Nel 2016, Max Verstappen ha vinto il suo primo Gran Premio (Spagna), diventando il pilota pi√π giovane a vincere in F1."},
  {m:6,d:15,y:1982,t:"Nel 1982, Gilles Villeneuve ha perso la vita durante le qualifiche del GP del Belgio a Spa."},
  {m:9,d:6,y:1957,t:"Nel 1957, Juan Manuel Fangio ha vinto il quinto titolo mondiale, un record durato 46 anni fino al 2003."},
  {m:10,d:6,y:1974,t:"Nel 1974, Niki Lauda ha vinto il primo titolo con Ferrari, iniziando una saga di rivalit√† e tragedie."},
  {m:12,d:5,y:2021,t:"Nel 2021, Abu Dhabi ha ospitato una delle gare pi√π controvertite: Verstappen ha vinto il primo titolo nell'ultimo giro."}
];

// CATEGORIE GOMME ‚Äî rimozione "risultato esatto pilota" da HARD
const CATS=[
  {id:"soft",label:"SOFT",color:"#E8002D",slots:1,pts:1,sits:[
    {id:"s_win",label:"Vincitore",tgt:"driver"},{id:"s_pts",label:"Pilota a punti",tgt:"driver"},
    {id:"s_h2h",label:"Testa a testa (X battue Y)",tgt:"driver"},{id:"s_fl",label:"Giro veloce",tgt:"driver"},
    {id:"s_tp",label:"Scuderia sul podio",tgt:"team"},{id:"s_td",label:"Doppietta scuderia",tgt:"team"},
    {id:"s_pw",label:"Vittoria dalla pole",tgt:"yesno"},{id:"s_fp",label:"Primo al pitstop",tgt:"driver"},
    {id:"s_lst",label:"Ultimo classificato",tgt:"driver"},{id:"s_fin",label:"Macchine al traguardo",tgt:"range"}
  ]},
  {id:"medium",label:"MEDIUM",color:"#FFC906",slots:1,pts:2,sits:[
    {id:"m_bp",label:"Entrambi piloti scuderia a punti",tgt:"team"},{id:"m_q3",label:"Fuori dal Q3",tgt:"driver"},
    {id:"m_dnf",label:"Ritirato dalla corsa",tgt:"driver"},{id:"m_pwp",label:"Vittoria dalla pole (pilota)",tgt:"driver"},
    {id:"m_mp",label:"Podio mono-scuderia",tgt:"team"},{id:"m_lst",label:"Ultimo classificato",tgt:"driver"}
  ]},
  {id:"hard",label:"HARD",color:"#C8C8C8",slots:1,pts:3,sits:[
    {id:"h_vsc",label:"Virtual Safety Car",tgt:"yesno"},{id:"h_pit",label:"Problemi ai box (>4s)",tgt:"driver"},
    {id:"h_q2",label:"Fuori dal Q2",tgt:"driver"}
  ]},
  {id:"intermedie",label:"INTERMEDIE",color:"#39B54A",slots:2,pts:4,sits:[
    {id:"i_sc",label:"Safety Car",tgt:"yesno"},{id:"i_pen",label:"Penalit√† durante la corsa",tgt:"driver"},
    {id:"i_gc",label:"Grand Chelem",tgt:"driver"}
  ]},
  {id:"fullwet",label:"FULL WET",color:"#0047AB",slots:2,pts:5,sits:[
    {id:"fw_inc",label:"Incidente durante la corsa",tgt:"driver_or_team"}
  ]}
];

const HCOLORS=[
  {n:"Nero",h:"#111111"},{n:"Bianco",h:"#F0F0F0"},{n:"Rosso F1",h:"#E10600"},
  {n:"Rosso Scuro",h:"#8B0000"},{n:"Blu Navy",h:"#1E3A5F"},{n:"Blu",h:"#0047AB"},
  {n:"Verde",h:"#006F62"},{n:"Lime",h:"#39B54A"},{n:"Oro",h:"#DAA520"},
  {n:"Argento",h:"#A8A9AD"},{n:"Arancio",h:"#FF8000"},{n:"Viola",h:"#6A0DAD"},
  {n:"Teal",h:"#008B8B"},{n:"Rosa",h:"#E91E8C"},{n:"Marrone",h:"#6B3A2A"}
];
const NUM_COLORS=[
  {n:"Bianco",h:"#FFFFFF"},{n:"Rosso",h:"#E10600"},{n:"Oro",h:"#DAA520"},
  {n:"Blu",h:"#0047AB"},{n:"Verde",h:"#39B54A"},{n:"Arancio",h:"#FF8000"},
  {n:"Nero",h:"#222222"},{n:"Rosa",h:"#E91E8C"}
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let usr=null, curPg='dashboard', selGP=0;
let pred={pole:null,podio:[null,null,null],gomme:[null,null,null]};
let prof={nickname:'',numero:7,numColor:'#FFFFFF',scuderia:'',pilota:'',avatar:{col1:'#E10600',col2:'#111111'},campionato:{pilota:'',team:'',confirmed:false}};
let confirmed=false;
let pkCtx=null;
let gpUnlocked={0:true}; // GP 0 (Australia) sempre sbloccato all'inizio
let allPlayers=[]; // cache giocatori da Firestore

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('loginBtn').addEventListener('click',()=>{
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).catch(e=>toast('Errore login: '+e.message));
});
document.getElementById('logoutBtn').addEventListener('click',()=>{
  auth.signOut().then(()=>{document.getElementById('login').classList.remove('hidden');document.getElementById('app').style.display='none';document.getElementById('onboard').classList.remove('show');});
  closeMenu();
});
auth.onAuthStateChanged(u=>{
  if(u){usr=u;document.getElementById('login').classList.add('hidden');loadProf();}
  else{document.getElementById('login').classList.remove('hidden');document.getElementById('app').style.display='none';document.getElementById('onboard').classList.remove('show');}
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MENU NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('menuBtn').addEventListener('click',()=>document.getElementById('menuOv').classList.add('open'));
document.getElementById('menuX').addEventListener('click',closeMenu);
document.getElementById('menuOv').addEventListener('click',function(e){if(e.target===this)closeMenu();});
function closeMenu(){document.getElementById('menuOv').classList.remove('open');}
document.querySelectorAll('.mi[data-pg]').forEach(b=>b.addEventListener('click',()=>{goTo(b.dataset.pg);closeMenu();}));
document.querySelectorAll('.nb[data-pg]').forEach(b=>b.addEventListener('click',()=>goTo(b.dataset.pg)));

function goTo(pg){
  document.querySelectorAll('.pg').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.mi').forEach(m=>m.classList.remove('active'));
  document.querySelectorAll('.nb').forEach(n=>n.classList.remove('active'));
  const t=document.getElementById('pg-'+pg);
  if(t)t.classList.add('active');
  document.querySelectorAll('.mi[data-pg="'+pg+'"]').forEach(m=>m.classList.add('active'));
  document.querySelectorAll('.nb[data-pg="'+pg+'"]').forEach(n=>n.classList.add('active'));
  curPg=pg;
  if(pg==='dashboard')renderDash();
  if(pg==='previsioni'){renderGpChips();renderPrev();}
  if(pg==='classifica')renderCl();
  if(pg==='profilio')renderProf();
  if(pg==='admin')renderAdmin();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initApp(){
  document.getElementById('app').style.display='flex';
  // Admin
  const ADMIN="";
  if(usr.email===ADMIN||ADMIN==="")document.getElementById('adminSec').style.display='block';
  // Load GP unlock status
  loadGpUnlocked();
  renderDash();
  renderGpChips();
  renderProf();
  populateSelects();
  renderHC();
  loadAllPlayers();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ONBOARDING ‚Äî Previsione Campionato
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showOnboard(){
  const ob=document.getElementById('onboard');
  // Popola select piloti
  const sp=document.getElementById('onbPiloti');
  sp.innerHTML='<option value="">Seleziona pilota...</option>'+D.map(d=>`<option value="${d.num}">${d.num} ${d.name} (${T[d.team].n})</option>`).join('');
  // Popola select team
  const st=document.getElementById('onbTeam');
  st.innerHTML='<option value="">Seleziona scuderia...</option>'+TK.map(tk=>`<option value="${tk}">${T[tk].n}</option>`).join('');
  sp.onchange=()=>checkOnbBtn();
  st.onchange=()=>checkOnbBtn();
  ob.classList.add('show');
}
function checkOnbBtn(){
  const p=document.getElementById('onbPiloti').value;
  const t=document.getElementById('onbTeam').value;
  document.getElementById('onbBtn').disabled=!(p&&t);
}
function confOnboard(){
  const p=document.getElementById('onbPiloti').value;
  const t=document.getElementById('onbTeam').value;
  if(!p||!t)return;
  prof.campionato={pilota:p,team:t,confirmed:true};
  // Save
  db.collection('users').doc(usr.uid).set({campionato:prof.campionato},{merge:true}).then(()=>{
    toast('‚úì Previsione campionato salvata!');
    document.getElementById('onboard').classList.remove('show');
    initApp();
  }).catch(e=>{
    console.error('Onboard save error:',e);
    toast('Errore salvataggio: '+e.message);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOAD PROFILO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loadProf(){
  if(!usr)return;
  db.collection('users').doc(usr.uid).get().then(doc=>{
    if(doc.exists){
      const d=doc.data();
      if(d.nickname)prof.nickname=d.nickname;
      if(d.numero)prof.numero=d.numero;
      if(d.numColor)prof.numColor=d.numColor;
      if(d.scuderia)prof.scuderia=d.scuderia;
      if(d.pilota)prof.pilota=d.pilota;
      if(d.avatar)prof.avatar=d.avatar;
      if(d.campionato)prof.campionato=d.campionato;
    }
    // Se campionato non confermato, mostra onboarding
    if(!prof.campionato.confirmed){
      showOnboard();
    } else {
      initApp();
    }
  }).catch(()=>{
    // Nuovo utente
    showOnboard();
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GP UNLOCK (Admin controlla, utenti leggono)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loadGpUnlocked(){
  db.collection('config').doc('gp_unlocked').get().then(doc=>{
    if(doc.exists){gpUnlocked=doc.data().unlocked||{0:true};}
    else{gpUnlocked={0:true};}
    renderGpChips();
  }).catch(()=>{gpUnlocked={0:true};});
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FIND GP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function curGP(){
  const now=new Date();
  for(let i=0;i<CAL.length;i++){if(now<new Date(CAL[i].race))return{gp:CAL[i],idx:i};}
  return{gp:CAL[CAL.length-1],idx:CAL.length-1};
}
function deadline(gp){const d=new Date(gp.fp1);d.setTime(d.getTime()-2*3600000);return d;}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDash(){
  const{gp,idx}=curGP();
  const c=NC[gp.nation]||["#1a1a24","#111"];
  document.getElementById('gpHeroBg').style.background=`linear-gradient(135deg,${c[0]}33 0%,${c[1]}22 100%)`;
  document.getElementById('gpHero').style.border=`1px solid ${c[0]}35`;
  document.getElementById('gpHero').style.borderRadius='12px';
  document.getElementById('gpFlag').textContent=`GP ${idx+1} / 24`;
  document.getElementById('gpName').textContent=gp.name;
  document.getElementById('gpLoc').textContent=gp.location;
  startCD(gp.race);
  renderChicca();
  // Curiosit√† del GP corrente sulla dashboard
  document.getElementById('curDash').innerHTML=(CUR[gp.nation]||[]).map(c=>`<div class="cur-item">${c}</div>`).join('');
  // Prossimo GP
  const next=idx+1<CAL.length?CAL[idx+1]:null;
  if(next){
    document.getElementById('nextGpDash').innerHTML=`<div style="display:flex;align-items:center;gap:10px;">
      <div style="flex:1;"><div style="font-size:14px;font-weight:700;color:#fff;">${next.name}</div><div style="font-size:10.5px;color:var(--g);">${next.location}</div><div style="font-size:10.5px;color:var(--gl);margin-top:2px;">${fmtDate(next.race)}</div></div>
      <div style="font-size:9.5px;color:var(--gold);text-transform:uppercase;letter-spacing:1px;font-weight:700;">GP ${next.id+1}/24 ‚Üí</div>
    </div>`;
  } else {
    document.getElementById('nextGpCard').style.display='none';
  }
  renderClMini();
}

function startCD(tgt){
  if(window._ci)clearInterval(window._ci);
  function upd(){
    let diff=new Date(tgt)-new Date();if(diff<0)diff=0;
    document.getElementById('cd-d').textContent=Math.floor(diff/86400000);
    document.getElementById('cd-h').textContent=String(Math.floor((diff%86400000)/3600000)).padStart(2,'0');
    document.getElementById('cd-m').textContent=String(Math.floor((diff%3600000)/60000)).padStart(2,'0');
    document.getElementById('cd-s').textContent=String(Math.floor((diff%60000)/1000)).padStart(2,'0');
  }
  upd();window._ci=setInterval(upd,1000);
}

function renderChicca(){
  const now=new Date(),m=now.getMonth()+1,d=now.getDate();
  let h=HIST.find(x=>x.m===m&&x.d===d);
  if(!h)h=HIST.filter(x=>x.m===m).sort((a,b)=>Math.abs(a.d-d)-Math.abs(b.d-d))[0];
  if(!h)h=HIST[0];
  document.getElementById('chiccaTxt').innerHTML=h.t.replace(/Nel (\d{4})/,'Nel <span class="yr">$1</span>');
}

function fmtDate(iso){return new Date(iso).toLocaleDateString('it-IT',{weekday:'long',day:'numeric',month:'long'});}
function fmtDateTime(iso){return new Date(iso).toLocaleString('it-IT',{weekday:'short',day:'numeric',month:'short',hour:'2-digit',minute:'2-digit'});}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PREVISIONI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderGpChips(){
  const{idx}=curGP();
  if(selGP===undefined)selGP=idx;
  document.getElementById('gpChips').innerHTML=CAL.map((g,i)=>{
    const isUnlocked=gpUnlocked[i]===true;
    const isActive=i===selGP;
    let cls='gp-chip';
    if(isActive)cls+=' active';
    if(!isUnlocked)cls+=' locked';
    return`<div class="${cls}" onclick="${isUnlocked?'selGPfn('+i+')':''}">${g.name}${!isUnlocked?' üîí':''}</div>`;
  }).join('');
}

function selGPfn(i){
  if(!gpUnlocked[i])return;
  selGP=i;
  confirmed=false;
  pred={pole:null,podio:[null,null,null],gomme:[null,null,null]};
  document.querySelectorAll('.gp-chip').forEach((c,j)=>{
    c.classList.toggle('active',j===i);
  });
  // Load saved predictions for this GP
  loadPred(i);
}

function loadPred(gpIdx){
  if(!usr)return;
  db.collection('predictions').doc(usr.uid+'_gp'+gpIdx).get().then(doc=>{
    if(doc.exists){
      const d=doc.data();
      // Reconstruct pred
      pred.pole=d.pole||null;
      pred.podio=(d.podio||[null,null,null]).map(p=>p?D.find(x=>x.num===p.num)||null:null);
      pred.gomme=(d.gomme||[null,null,null]).map(g=>g?reconstructGomma(g):null);
      confirmed=d.confirmed||false;
    } else {
      pred={pole:null,podio:[null,null,null],gomme:[null,null,null]};
      confirmed=false;
    }
    renderPrev();
  }).catch(()=>{renderPrev();});
}

function reconstructGomma(g){
  if(!g||!g.catId)return null;
  const cat=CATS.find(c=>c.id===g.catId);
  if(!cat)return null;
  const sit=cat.sits.find(s=>s.id===g.sitId);
  if(!sit)return null;
  let disp=g.value||'';
  if(disp.startsWith('driver_')){const n=parseInt(disp.split('_')[1]);const d=D.find(x=>x.num===n);if(d)disp=d.name;}
  if(disp.startsWith('team_')){const tk=disp.split('_')[1];if(T[tk])disp=T[tk].n;}
  return{catId:cat.id,catLabel:cat.label,color:cat.color,slots:cat.slots,pts:cat.pts,sitId:sit.id,sitLabel:sit.label,value:g.value,disp};
}

function renderPrev(){
  const gp=CAL[selGP];
  const dl=deadline(gp);
  const now=new Date();
  const isLocked=!gpUnlocked[selGP];
  const isPastDeadline=now>dl;
  const isBlocked=isLocked||isPastDeadline||confirmed;

  // Deadline banner
  if(isLocked){
    document.getElementById('dlBan').className='dl-ban locked-ban';
    document.getElementById('dlVal').textContent='GP non ancora sbloccato';
  } else {
    const isUrgent=(dl-now)<1800000&&(dl-now)>0;
    document.getElementById('dlBan').className='dl-ban'+(isUrgent?' urgent':'');
    document.getElementById('dlVal').textContent=dl.toLocaleString('it-IT',{weekday:'long',day:'numeric',month:'long',hour:'2-digit',minute:'2-digit'});
  }

  renderPole(isBlocked);
  renderPodio(isBlocked);
  renderGomme(isBlocked);
  renderGommeLegenda();

  const btnConf=document.getElementById('btnConf');
  btnConf.disabled=isBlocked;
  if(confirmed)btnConf.textContent='‚úì PREVISIONI CONFERMATE';
  else if(isLocked)btnConf.textContent='GP BLOCCATO üîí';
  else if(isPastDeadline)btnConf.textContent='DEADLINE SUPERATO';
  else btnConf.textContent='CONFERMA PREVISIONI';
}

function renderPole(blocked){
  const box=document.getElementById('poleBox');
  const val=document.getElementById('poleVal');
  if(pred.pole){
    box.classList.add('sel');
    val.textContent=pred.pole.name;
    box.onclick=blocked?null:()=>openPk('pole',0);
  } else {
    box.classList.remove('sel');
    val.textContent='Seleziona pilota';
    box.onclick=blocked?null:()=>openPk('pole',0);
  }
  if(blocked)box.style.cursor='default';
  else box.style.cursor='pointer';
}

function renderPodio(blocked){
  const lbls=['ü•á 1¬∞','ü•à 2¬∞','ü•â 3¬∞'],cls=['p1','p2','p3'],order=['p2','p1','p3'];
  // Build in visual order: 2nd, 1st, 3rd
  document.getElementById('podioGrid').innerHTML=order.map(pos=>{
    const i=pos==='p1'?0:pos==='p2'?1:2;
    const s=pred.podio[i];
    return`<div class="podio-col ${pos}">
      <div class="podio-block ${s?'sel':''}" onclick="${blocked?'':'openPk(\'podio\','+i+')'}" style="${blocked?'cursor:default;':''}">
        <div class="pp ${cls[i]}">${lbls[i]}</div>
        <div class="pv">${s?s.name:'Seleziona'}</div>
        ${s?`<div class="pt" style="color:${T[s.team].c};">${T[s.team].n}</div>`:''}
      </div>
    </div>`;
  }).join('');
}

function renderGomme(blocked){
  let used=pred.gomme.filter(g=>g).reduce((s,g)=>s+g.slots,0);
  const rem=3-used;
  document.getElementById('slotsLabel').textContent=`${rem} slot disponibili`;
  let html='';
  let filledCount=0;
  for(let i=0;i<3;i++){
    const g=pred.gomme[i];
    if(g){
      filledCount++;
      html+=`<div class="g-slot filled" style="border-color:${g.color};background:${g.color}12;">
        <div class="sl" style="color:${g.color};">${g.catLabel}</div>
        <div class="sv">${g.sitLabel}</div>
        ${blocked?'': `<span class="sx" onclick="rmGomma(${i})" style="color:${g.color};">‚úï</span>`}
      </div>`;
    } else if(rem>0 && !blocked){
      html+=`<div class="g-slot" onclick="openCatPk(${i})"><div class="sn">${i+1}</div></div>`;
    } else {
      html+=`<div class="g-slot blocked"><div class="sn">‚Äî</div></div>`;
    }
  }
  document.getElementById('gommeSlots').innerHTML=html;
}

function renderGommeLegenda(){
  // Mostra valore di ogni previsione gomma inserita
  const filled=pred.gomme.filter(g=>g);
  if(filled.length===0){
    document.getElementById('gommeLeg').innerHTML=`<div class="gl-title">Valore Previsioni</div><div style="font-size:10px;color:var(--g);text-align:center;padding:6px 0;">Nessuna previsione inserita ancora</div>`;
    return;
  }
  let html='<div class="gl-title">Valore Previsioni Inserite</div>';
  filled.forEach(g=>{
    html+=`<div class="gl-row">
      <div class="gl-tire" style="background:${g.color};${g.color==='#C8C8C8'?'border:1px solid var(--bdr);':''}"></div>
      <div class="gl-info">
        <div class="gl-name" style="color:${g.color};">${g.catLabel}</div>
        <div class="gl-sub">${g.sitLabel}${g.disp?' ‚Äî '+g.disp:''}</div>
      </div>
      <div class="gl-pts" style="color:${g.color};">${g.pts} ${g.pts===1?'Boero':'Boeri'}</div>
    </div>`;
  });
  // Total
  const tot=filled.reduce((s,g)=>s+g.pts,0);
  html+=`<div style="margin-top:6px;padding-top:6px;border-top:1px solid var(--bdr);display:flex;justify-content:space-between;"><span style="font-size:9.5px;color:var(--g);font-weight:600;text-transform:uppercase;letter-spacing:.5px;">Totale gomme</span><span style="font-size:11px;font-weight:700;color:#fff;">${tot} ${tot===1?'Boero':'Boeri'}</span></div>`;
  document.getElementById('gommeLeg').innerHTML=html;
}

function rmGomma(i){
  pred.gomme[i]=null;
  const f=pred.gomme.filter(g=>g!==null);
  pred.gomme=[...f,...Array(3-f.length).fill(null)];
  renderGomme(false);renderGommeLegenda();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PICKER SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openPk(type,idx){
  pkCtx={type,idx};
  if(type==='pole'||type==='podio'){
    document.getElementById('pkTitle').textContent=type==='pole'?'Pole Position':['1¬∞ Posto','2¬∞ Posto','3¬∞ Posto'][idx];
    document.getElementById('pkList').innerHTML=D.map(d=>`<div class="pk-item" onclick="selPkDriver(${d.num})">
      <span class="pn" style="color:${T[d.team].c};">${d.num}</span>
      <span class="td" style="background:${T[d.team].c};"></span>
      <div><div class="nm">${d.name}</div><div class="tm">${T[d.team].n}</div></div>
    </div>`).join('');
  }
  document.getElementById('pkOv').classList.add('open');
}
function selPkDriver(num){
  const d=D.find(x=>x.num===num);
  if(pkCtx.type==='pole'){pred.pole=d;closePk();renderPole(false);}
  if(pkCtx.type==='podio'){pred.podio[pkCtx.idx]=d;closePk();renderPodio(false);}
}

function openCatPk(slotIdx){
  let used=pred.gomme.filter(g=>g).reduce((s,g)=>s+g.slots,0);
  const rem=3-used;
  pkCtx={type:'cat',slotIdx};
  document.getElementById('pkTitle').textContent='Scegli Gomma';
  document.getElementById('pkList').innerHTML=CATS.map(cat=>{
    const ok=cat.slots<=rem;
    return`<div class="pk-item" style="${ok?'':'opacity:.28;pointer-events:none;'}" onclick="selCat('${cat.id}')">
      <div style="width:28px;height:28px;border-radius:50%;background:${cat.color};display:flex;align-items:center;justify-content:center;flex-shrink:0;${cat.color==='#C8C8C8'?'border:1px solid var(--bdr);':''}">${tireSVG(cat.color)}</div>
      <div class="cat-info"><div class="cat-name" style="color:${cat.color};">${cat.label}</div><div class="cat-sub">${cat.pts} ${cat.pts===1?'Boero':'Boeri'} ¬∑ ${cat.slots} SLOT${cat.slots>1?' (doppio)':''}</div></div>
    </div>`;
  }).join('');
  document.getElementById('pkOv').classList.add('open');
}

function tireSVG(col){
  return`<svg width="16" height="16" viewBox="0 0 16 16"><circle cx="8" cy="8" r="7" fill="none" stroke="${col==='#C8C8C8'?'#999':'#fff'}" stroke-width="2.5"/><circle cx="8" cy="8" r="2.5" fill="${col==='#C8C8C8'?'#999':'#fff'}"/></svg>`;
}

function selCat(catId){
  const cat=CATS.find(c=>c.id===catId);
  pkCtx.cat=cat;
  document.getElementById('pkTitle').textContent=cat.label+' ‚Äî Situazione';
  document.getElementById('pkList').innerHTML=cat.sits.map(s=>`<div class="pk-item" onclick="selSit('${s.id}')">${s.label}</div>`).join('');
}

function selSit(sitId){
  const cat=pkCtx.cat,sit=cat.sits.find(s=>s.id===sitId);
  pkCtx.sit=sit;
  if(sit.tgt==='yesno'){
    document.getElementById('pkTitle').textContent=sit.label;
    document.getElementById('pkList').innerHTML=['S√¨','No'].map(v=>`<div class="pk-item" onclick="finalPred('${v.toLowerCase()}')">${v}</div>`).join('');
    return;
  }
  if(sit.tgt==='range'){
    document.getElementById('pkTitle').textContent=sit.label;
    document.getElementById('pkList').innerHTML=['1‚Äì14','15‚Äì18','19‚Äì22'].map(v=>`<div class="pk-item" onclick="finalPred('${v}')">${v}</div>`).join('');
    return;
  }
  document.getElementById('pkTitle').textContent=sit.label;
  let html=D.map(d=>`<div class="pk-item" onclick="finalPred('driver_${d.num}')">
    <span class="pn" style="color:${T[d.team].c};">${d.num}</span>
    <span class="td" style="background:${T[d.team].c};"></span>
    <div><div class="nm">${d.name}</div><div class="tm">${T[d.team].n}</div></div>
  </div>`).join('');
  if(sit.tgt==='driver_or_team'){
    html+='<div style="height:1px;background:var(--bdr);margin:3px 0;"></div>';
    html+=TK.map(tk=>`<div class="pk-item" onclick="finalPred('team_${tk}')">
      <span class="td" style="background:${T[tk].c};width:11px;height:11px;"></span>
      <div><div class="nm">${T[tk].n}</div><div class="tm">Scuderia</div></div>
    </div>`).join('');
  }
  document.getElementById('pkList').innerHTML=html;
}

function finalPred(val){
  const cat=pkCtx.cat,sit=pkCtx.sit;
  let disp=val;
  if(val.startsWith('driver_')){const n=parseInt(val.split('_')[1]);const d=D.find(x=>x.num===n);disp=d?d.name:val;}
  if(val.startsWith('team_')){const tk=val.split('_')[1];disp=T[tk]?T[tk].n:val;}
  pred.gomme[pkCtx.slotIdx]={catId:cat.id,catLabel:cat.label,color:cat.color,slots:cat.slots,pts:cat.pts,sitId:sit.id,sitLabel:sit.label,value:val,disp};
  closePk();renderGomme(false);renderGommeLegenda();
}

function closePk(){document.getElementById('pkOv').classList.remove('open');pkCtx=null;}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFERMA PREVISIONI ‚Äî SAVE TO FIRESTORE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function conferma(){
  if(confirmed){toast('Gi√† confermate!');return;}
  if(!pred.pole){toast('Seleziona la pole position');return;}
  if(!pred.podio.every(p=>p)){toast('Completa prima il podio');return;}
  if(!pred.gomme.some(g=>g)){toast('Scegli almeno una gomma');return;}
  confirmed=true;
  const gpId=selGP;
  const payload={
    userId:usr.uid,
    userEmail:usr.email,
    gpId,
    pole:pred.pole?{num:pred.pole.num,name:pred.pole.name,team:pred.pole.team}:null,
    podio:pred.podio.map(p=>p?{num:p.num,name:p.name,team:p.team}:null),
    gomme:pred.gomme.map(g=>g?{catId:g.catId,sitId:g.sitId,value:g.value}:null),
    confirmed:true,
    confirmedAt:firebase.firestore.FieldValue.serverTimestamp()
  };
  db.collection('predictions').doc(usr.uid+'_gp'+gpId).set(payload).then(()=>{
    toast('‚úì Previsioni salvate!');
    renderPrev();
  }).catch(e=>{
    console.error('Save error:',e);
    toast('Errore salvataggio: '+e.message);
    confirmed=false;
    renderPrev();
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CLASSIFICA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loadAllPlayers(){
  db.collection('users').get().then(snap=>{
    allPlayers=[];
    snap.forEach(doc=>{
      const d=doc.data();
      d.uid=doc.id;
      allPlayers.push(d);
    });
  }).catch(()=>{});
}

function renderCl(){
  // Use allPlayers + mock data for demo
  const players=getMockPlayers();
  players.sort((a,b)=>b.pts-a.pts);
  document.getElementById('clList').innerHTML=players.map((p,i)=>{
    const rc=i===0?'r1':i===1?'r2':i===2?'r3':'ro';
    const tc=i===0?'t1':i===1?'t2':i===2?'t3':'';
    return`<div class="cl-item ${tc}" onclick="showPlayerPop(${JSON.stringify(p).replace(/"/g,'&quot;')})">
      <div class="rb ${rc}">${i+1}</div>
      ${avatarHTML(p,36)}
      <div class="cl-inf"><div class="cl-nm">${p.nickname||'Giocatore'}</div><div class="cl-st">${p.wins||0} vitt. ¬∑ ${p.pod||0} podii</div></div>
      <div class="cl-pts"><span class="cl-pn">${p.pts}</span>${boero('red',17)}</div>
    </div>`;
  }).join('');
}

function renderClMini(){
  const players=getMockPlayers().sort((a,b)=>b.pts-a.pts).slice(0,3);
  document.getElementById('clMini').innerHTML=players.map((p,i)=>{
    const c=['#DAA520','#A8A9AD','#CD7F32'][i];
    return`<div style="display:flex;align-items:center;gap:9px;padding:7px 0;${i<2?'border-bottom:1px solid var(--bdr);':''}">
      <span style="font-family:'Bebas Neue';font-size:15px;color:${c};min-width:16px;">${i+1}</span>
      ${avatarHTML(p,26)}
      <span style="font-size:12.5px;font-weight:600;flex:1;">${p.nickname||'Giocatore'}</span>
      <span style="font-size:13px;font-weight:700;display:flex;align-items:center;gap:2px;">${p.pts}${boero('red',13)}</span>
    </div>`;
  }).join('');
}

function getMockPlayers(){
  // Combine real user + mock players
  const me={nickname:prof.nickname||'Tu',numero:prof.numero,numColor:prof.numColor,avatar:prof.avatar,pts:47,wins:1,pod:2,scuderia:prof.scuderia,pilota:prof.pilota,campionato:prof.campionato};
  const mocks=[
    {nickname:'Verstappen Fan',numero:1,numColor:'#DAA520',avatar:{col1:'#1E3A5F',col2:'#DAA520'},pts:42,wins:1,pod:1,scuderia:'redbull',pilota:'3',campionato:{pilota:'3',team:'redbull',confirmed:true}},
    {nickname:'Scossa',numero:44,numColor:'#FFFFFF',avatar:{col1:'#A8A9AD',col2:'#006F62'},pts:38,wins:0,pod:2,scuderia:'mercedes',pilota:'63',campionato:{pilota:'63',team:'mercedes',confirmed:true}},
    {nickname:'La Macchina',numero:16,numColor:'#FF8000',avatar:{col1:'#8B0000',col2:'#F0F0F0'},pts:35,wins:1,pod:1,scuderia:'ferrari',pilota:'16',campionato:{pilota:'16',team:'ferrari',confirmed:true}}
  ];
  return[me,...mocks];
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// POPUP PROFILO GIOCATORE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showPlayerPop(p){
  document.getElementById('popAvatar').innerHTML='';
  document.getElementById('popAvatar').style.background=`linear-gradient(135deg,${p.avatar?.col1||'#E10600'},${p.avatar?.col2||'#111'})`;
  document.getElementById('popAvatar').style.width='64px';
  document.getElementById('popAvatar').style.height='64px';
  document.getElementById('popAvatar').style.borderRadius='50%';
  document.getElementById('popAvatar').style.display='flex';
  document.getElementById('popAvatar').style.alignItems='center';
  document.getElementById('popAvatar').style.justifyContent='center';
  document.getElementById('popAvatar').innerHTML=`<span style="font-family:'Bebas Neue';font-size:22px;color:${p.numColor||'#fff'};">${p.numero||'?'}</span>`;
  document.getElementById('popNum').textContent=p.numero||'?';
  document.getElementById('popNum').style.color=p.numColor||'#E10600';
  document.getElementById('popNm').textContent=p.nickname||'Giocatore';
  // Body
  const sc=p.scuderia&&T[p.scuderia]?T[p.scuderia].n:'‚Äî';
  const pi=p.pilota?D.find(d=>String(d.num)===String(p.pilota)):null;
  const camp=p.campionato||{};
  const campPil=camp.pilota?D.find(d=>String(d.num)===String(camp.pilota)):null;
  const campTeam=camp.team&&T[camp.team]?T[camp.team].n:'‚Äî';
  document.getElementById('popBody').innerHTML=`
    <div class="pop-row"><span class="pr-l">Scuderia</span><span class="pr-v">${sc}</span></div>
    <div class="pop-row"><span class="pr-l">Pilota Preferito</span><span class="pr-v">${pi?pi.name:'‚Äî'}</span></div>
    <div class="pop-row"><span class="pr-l">üèÜ Camp. Piloti</span><span class="pr-v">${campPil?campPil.name:'‚Äî'}</span></div>
    <div class="pop-row"><span class="pr-l">üèéÔ∏è Camp. Costruttori</span><span class="pr-v">${campTeam}</span></div>
    <div class="pop-row"><span class="pr-l">Punti Totali</span><span class="pr-v" style="color:var(--gold);">${p.pts||0} Boeri</span></div>
  `;
  document.getElementById('popOv').classList.add('open');
}
function closePop(){document.getElementById('popOv').classList.remove('open');}
document.getElementById('popOv').addEventListener('click',function(e){if(e.target===this)closePop();});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROFILO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function populateSelects(){
  // Scuderia
  const sc=document.getElementById('inSc');
  if(sc){sc.innerHTML='<option value="">Seleziona...</option>'+TK.map(tk=>`<option value="${tk}">${T[tk].n}</option>`).join('');}
  // Pilota
  const pl=document.getElementById('inPil');
  if(pl){pl.innerHTML='<option value="">Seleziona...</option>'+D.map(d=>`<option value="${d.num}">${d.num} ${d.name}</option>`).join('');}
  // Colore numero
  const nc=document.getElementById('inNumColor');
  if(nc){nc.innerHTML=NUM_COLORS.map(c=>`<option value="${c.h}" style="background:${c.h};color:${c.h==='#FFFFFF'||c.h==='#DAA520'?'#000':'#fff'};">${c.n}</option>`).join('');}
}

function renderProf(){
  document.getElementById('profNm').textContent=prof.nickname||'Il Tuo Nome';
  document.getElementById('profNum').textContent=prof.numero||7;
  document.getElementById('profEmail').textContent=usr?usr.email:'‚Äî';
  // Avatar
  document.getElementById('profAvatar').style.background=`linear-gradient(135deg,${prof.avatar.col1},${prof.avatar.col2})`;
  document.getElementById('profAvatar').innerHTML=`<span style="font-family:'Bebas Neue';font-size:32px;color:${prof.numColor};">${prof.numero||7}</span>`;
  // Inputs
  const ni=document.getElementById('inNick');if(ni)ni.value=prof.nickname||'';
  const nu=document.getElementById('inNum');if(nu)nu.value=prof.numero||7;
  const nc=document.getElementById('inNumColor');if(nc)nc.value=prof.numColor||'#FFFFFF';
  const sc=document.getElementById('inSc');if(sc)sc.value=prof.scuderia||'';
  const pl=document.getElementById('inPil');if(pl)pl.value=prof.pilota||'';
  renderHC();
  // Previsione campionato nel profilo
  renderProfCamp();
}

function renderProfCamp(){
  const camp=prof.campionato||{};
  if(camp.confirmed){
    const pi=camp.pilota?D.find(d=>String(d.num)===String(camp.pilota)):null;
    const te=camp.team&&T[camp.team]?T[camp.team]:null;
    document.getElementById('profCamp').innerHTML=`
      <div class="camp-card">
        <div class="cc-t">ü•á Previsione Campionato ‚Äî Confermata</div>
        <div class="cc-row"><span class="cc-l">Campione Piloti</span><span class="cc-v">${pi?pi.name:'‚Äî'} ${boero('gold',14)}</span></div>
        <div class="cc-row"><span class="cc-l">Campione Costruttori</span><span class="cc-v">${te?te.n:'‚Äî'} ${boero('gold',14)}</span></div>
        <div class="cc-locked">üîí Questa previsione non pu√≤ essere pi√π modificata.</div>
      </div>`;
  } else {
    document.getElementById('profCamp').innerHTML=`<div style="font-size:11px;color:var(--g);text-align:center;padding:8px 0;">Previsione campionato non ancora inserita.</div>`;
  }
}

function updProf(){
  prof.nickname=document.getElementById('inNick').value;
  prof.numero=parseInt(document.getElementById('inNum').value)||7;
  prof.numColor=document.getElementById('inNumColor').value||'#FFFFFF';
  document.getElementById('profNm').textContent=prof.nickname||'Il Tuo Nome';
  document.getElementById('profNum').textContent=prof.numero;
  document.getElementById('profAvatar').style.background=`linear-gradient(135deg,${prof.avatar.col1},${prof.avatar.col2})`;
  document.getElementById('profAvatar').innerHTML=`<span style="font-family:'Bebas Neue';font-size:32px;color:${prof.numColor};">${prof.numero||7}</span>`;
}

function saveProf(){
  prof.nickname=document.getElementById('inNick').value;
  prof.numero=parseInt(document.getElementById('inNum').value)||7;
  prof.numColor=document.getElementById('inNumColor').value||'#FFFFFF';
  prof.scuderia=document.getElementById('inSc').value;
  prof.pilota=document.getElementById('inPil').value;
  if(!usr)return;
  db.collection('users').doc(usr.uid).set({
    nickname:prof.nickname,numero:prof.numero,numColor:prof.numColor,
    scuderia:prof.scuderia,pilota:prof.pilota,avatar:prof.avatar
  },{merge:true}).then(()=>toast('‚úì Profilo salvato!')).catch(()=>toast('Errore'));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELMET / AVATAR COLORS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderHC(){
  document.querySelectorAll('.hc-row').forEach(row=>{
    const tgt=row.dataset.tgt;
    row.innerHTML=HCOLORS.map(c=>{
      const sel=prof.avatar[tgt]===c.h;
      return`<div class="hc-swatch" onclick="setHC('${tgt}','${c.h}')" style="background:${c.h};border:${sel?'2.5px solid var(--red)':'2px solid var(--bdr)'};box-shadow:${sel?'0 0 5px rgba(225,6,0,.5)':'none'};" title="${c.n}"></div>`;
    }).join('');
  });
}
function setHC(tgt,hex){
  prof.avatar[tgt]=hex;
  document.getElementById('profAvatar').style.background=`linear-gradient(135deg,${prof.avatar.col1},${prof.avatar.col2})`;
  renderHC();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAdmin(){
  let html='';
  CAL.forEach((gp,i)=>{
    const unlocked=gpUnlocked[i]===true;
    html+=`<div style="display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--bdr);">
      <span style="font-size:11.5px;color:${unlocked?'#fff':'var(--g)'};">${gp.name} <span style="font-size:9px;color:var(--g);">GP ${i+1}</span></span>
      <button onclick="toggleGP(${i})" style="background:${unlocked?'var(--inter)':'var(--surf3)'};color:#fff;border:none;padding:4px 10px;border-radius:6px;font-size:10px;font-weight:700;cursor:pointer;font-family:'Barlow Condensed',sans-serif;letter-spacing:.5px;">${unlocked?'‚úì APERTO':'üîí BLOCCATO'}</button>
    </div>`;
  });
  document.getElementById('adminGpList').innerHTML=html;
}

function toggleGP(idx){
  gpUnlocked[idx]=!gpUnlocked[idx];
  // Save to Firestore
  db.collection('config').doc('gp_unlocked').set({unlocked:gpUnlocked},{merge:true}).then(()=>{
    toast(gpUnlocked[idx]?'‚úì GP sbloccato!':'GP bloccato');
    renderAdmin();renderGpChips();
  }).catch(()=>toast('Errore'));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AVATAR HTML HELPER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function avatarHTML(p,size){
  const col1=p.avatar?.col1||'#E10600';
  const col2=p.avatar?.col2||'#111';
  const nc=p.numColor||'#fff';
  const num=p.numero||'?';
  return`<div style="width:${size}px;height:${size}px;border-radius:50%;background:linear-gradient(135deg,${col1},${col2});display:flex;align-items:center;justify-content:center;flex-shrink:0;border:2px solid var(--bdr);">
    <span style="font-family:'Bebas Neue';font-size:${Math.round(size*.6)}px;color:${nc};">${num}</span>
  </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BOERO SVG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function boero(v,s){
  const pc=v==='red'?'#E8002D':v==='blue'?'#0047AB':'#DAA520';
  return`<svg width="${s}" height="${s+3}" viewBox="0 0 28 34" style="display:inline-block;vertical-align:middle;"><ellipse cx="14" cy="31" rx="8" ry="2" fill="#050505"/><rect x="6" y="18" width="16" height="7" rx="2.5" fill="#3B1F0B"/><ellipse cx="14" cy="18" rx="8" ry="7" fill="#5C3317"/><ellipse cx="11.5" cy="15.5" rx="3.5" ry="2.8" fill="#7A4A2A"/><rect x="8.5" y="16.5" width="11" height="4" fill="${pc}"/><rect x="9.2" y="8" width="9.6" height="9.5" rx="1" fill="${pc}"/><ellipse cx="14" cy="8" rx="4.8" ry="2" fill="${pc}"/><ellipse cx="14" cy="20.5" rx="5.5" ry="1.2" fill="${pc}" opacity=".7"/><text x="14" y="16.2" text-anchor="middle" fill="white" font-family="Arial" font-weight="bold" font-size="7.5">B</text></svg>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2200);}
</script>
</body>
</html>
